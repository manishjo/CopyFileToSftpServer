## Defining variables used for this program
$source_dir = "<Source Dir where file will be genrated>"
$ArchivePath ="<Arhive folder Dir>"

## Load WinSCP .NET assembly
Add-Type -Path "<path>\WinSCPnet.dll"

## Set up SFTP session options
$sessionOptions = New-Object WinSCP.SessionOptions -Property @{
Protocol = [WinSCP.Protocol]::Sftp
HostName = "<sftp host name>"
UserName = "<user>"
Password = "<password>"
SshHostKeyFingerprint = "<host key to connect to sftp server>"
}

## Checking if RMA file exist for todays date
$File = Get-ChildItem -Path $source_dir -Filter '<file>*' | Where-Object {$_.LastWriteTime -gt (Get-Date).Date}
$FullFilePath = $source_dir + $File.Namefunction 

## Function to copy file to SFTP server
CopyFileToSftpServer { 
echo 'RMA File found for todays date with name' $FullFilePath 'Now i am copying it to SFTP server'
$session = New-Object WinSCP.Session
try{
$session.Open($sessionOptions)
$session.PutFiles($FullFilePath, "/demo/").Check()
}
finally{
$session.Dispose()
}
Write-Host 'RMA File has been copied to SFTP server fine'
}

## Function to move file to Archive
function MoveFileToArchive { 
Write-Host 'Now i am moving RMA file to Archive folder'
Get-ChildItem â€“Path $FullFilePath | Move-Item -Destination $ArchivePath
Write-Host 'RMA File has been moved to Archive folder successfully'
}

## If RMA file found for todays date copy to sftp server, else inform file does not exist.
if(Test-Path -Path $FullFilePath -PathType Leaf) {
CopyFileToSftpServer; #calling copy to sftp function
MoveFileToArchive; #calling move to archive function
}
else {
Write-Host 'RMA File does not exist for todays date, Program is exiting'
}


